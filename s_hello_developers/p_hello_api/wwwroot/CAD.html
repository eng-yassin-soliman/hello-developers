<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ArabiCAD</title>

    <!--External Style Sheet Files-->
    <link rel="stylesheet" type="text/css" href="_s_reset.css">
    <link rel="stylesheet" type="text/css" href="_s_cad.css">
    <!--Internal Style Sheet-->
    <style type="text/css">
    </style>

    <!--External Script File-->
    <script type="text/javascript" src="_j_cad.js"></script>
    <!--Internal Script-->
    <script type="text/javascript">
        class _c_drawing {
            constructor(p_uid_, p_nam_, p_dat_, p_lin_, p_fil_) {
                this.s_uid_ = p_uid_;   // ID
                this.s_nam_ = p_nam_;   // Name
                this.s_dat_ = p_dat_;   // Drawing data
                this.s_lin_ = p_lin_;   // Line color
                this.s_fil_ = p_fil_;   // Filling color of the shape
            }
        }

        // Post the message to server
        function v_send_(p_msg_) {
            v_post_(p_msg_, v_success_, v_error_);
        }

        // Handle the response is succeeded
        function v_success_(p_rsp_) {
            var l_drw_ = JSON.parse(p_rsp_);
            l_drw_.forEach(function (p_itm_, p_ndx_) {
                v_drawitem_(p_itm_);
            });
        }

        // Handle the response on error
        function v_error_(p_rsp_) {
            alert("Error: " + p_rsp_);
        }

        function v_drawitem_(p_itm_) {
            var l_svg_ = document.getElementById('b_svg_');
            var l_pth_ = document.createElementNS("http://www.w3.org/2000/svg", 'path');
            l_pth_.setAttribute("d", p_itm_.s_dat_);
            l_pth_.setAttribute("stroke-width", 3);
            l_pth_.setAttribute("stroke", p_itm_.s_lin_);
            l_pth_.setAttribute("fill", p_itm_.s_fil_);

            l_svg_.appendChild(l_pth_);
        }

        function v_draw_() {
            // Clear drawing panel
            var l_svg_ = document.getElementById('b_svg_');
            l_svg_.innerHTML = '';

            var l_uid_ = localStorage.getItem("r_uid_");            // ID from local storage
            var l_nam_ = document.getElementById('b_nam_').value;   // Client's name
            var l_dat_ = document.getElementById('b_dat_').value;   // Data describes the drawing
            var l_lin_ = document.getElementById('b_lin_').value;   // Line color
            var l_fil_ = document.getElementById('b_fil_').value;   // Fill color


            // Check if ID stored
            if (l_uid_ === null) {
                // Generate random ID
                l_uid_ = Math.floor(Math.random() * 100000000); // Random integer ID between 0 - 99999999
                localStorage.setItem("r_uid_", l_uid_);         // Store local storage ID
            }

            // JSON formatted instant of drawing class
            var l_msg_ = new _c_drawing(l_uid_, l_nam_, l_dat_, l_lin_, l_fil_);
            v_post_obj_("CAD/api", l_msg_, v_success_, v_error_);
        }

/**/</script>
</head>

<body>
    <table>
        <tr>
            <td>
                <svg id="b_svg_" style="width:400px;height:400px;margin:20px; border:solid 1px silver"></svg>
                <br />

                <button class="_button" onclick="v_draw_()">Draw!</button>
            </td>

            <td>
                <input id="b_nam_" type="text" value="Name"
                       style="width:400px; padding:10px; margin:20px 20px 0px 0px; border:solid 1px silver" />
                <br />

                <input id="b_lin_" type="text" value="silver"
                       style="width:185px; padding:10px; margin:20px 20px 0px 0px; border:solid 1px silver" />

                <input id="b_fil_" type="text" value="rgba(0,255,0,0.3)"
                       style="width:190px; padding:10px; margin:20px 20px 0px 0px; border:solid 1px silver" />
                <br />

                <textarea id="b_dat_" class="_text" style="height:275px; margin:20px 20px 0px 0px">

</textarea>
            </td>
        </tr>
    </table>
</body>
</html>